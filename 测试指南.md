# 测试指南 - 时间选择功能

## 本地测试

### 1. 启动应用

```bash
cd discord-exporter
pip install -r requirements.txt
python app.py
```

访问：`http://localhost:5000`

### 2. 测试时间选择功能

#### 测试点 1：时间选择器显示
- ✅ 开始时间输入框应显示日期和时间选择器
- ✅ 结束时间输入框应显示日期和时间选择器
- ✅ 点击输入框时应出现日历和时钟界面

#### 测试点 2：时间格式提交
打开浏览器开发者工具（F12），切换到 Network 标签，执行导出操作，检查请求体：

**预期格式：**
```json
{
  "urls": ["https://discord.com/channels/xxx/xxx"],
  "date_from": "2026-03-02T09:00",
  "date_to": "2026-03-02T17:00",
  "format": "excel"
}
```

#### 测试点 3：不同时间场景

| 场景 | 开始时间 | 结束时间 | 预期结果 |
|------|---------|---------|---------|
| 场景 A | 2026-03-02T09:00 | 2026-03-02T12:00 | 只导出上午9点到12点的消息 |
| 场景 B | 2026-03-01T22:00 | 2026-03-02T02:00 | 导出跨夜消息 |
| 场景 C | 2026-03-02T15:30 | (留空) | 导出15:30之后的所有消息 |
| 场景 D | (留空) | 2026-03-02T18:00 | 导出18:00之前的所有消息 |
| 场景 E | (留空) | (留空) | 导出全部消息 |

#### 测试点 4：向后兼容性
如果使用 API 直接发送旧格式的日期：

```bash
curl -X POST http://localhost:5000/api/export \
  -H "Content-Type: application/json" \
  -d '{
    "urls": ["https://discord.com/channels/xxx/xxx"],
    "date_from": "2026-03-02",
    "date_to": "2026-03-03",
    "format": "excel"
  }'
```

**预期行为：**
- ✅ 应该能正常处理
- ✅ date_to 应自动设置为 2026-03-03 23:59:59

#### 测试点 5：错误处理

```bash
# 测试无效的时间格式
curl -X POST http://localhost:5000/api/export \
  -H "Content-Type: application/json" \
  -d '{
    "urls": ["https://discord.com/channels/xxx/xxx"],
    "date_from": "invalid-date",
    "format": "excel"
  }'
```

**预期结果：**
- ✅ 应返回 400 错误
- ✅ 错误信息应包含 "日期时间格式错误"

### 3. 验证导出结果

导出完成后，检查文件内容：

#### Excel 文件检查
- ✅ "消息时间" 列应包含完整的时间（YYYY-MM-DD HH:MM:SS）
- ✅ 只包含指定时间范围内的消息
- ✅ 时间排序正确

#### TXT 文件检查
- ✅ 每条消息前显示完整时间戳
- ✅ 时间范围正确

#### HTML 文件检查
- ✅ 在浏览器中打开，显示正常
- ✅ 时间信息完整显示
- ✅ 样式正常

## 部署到 Zeabur 后测试

### 1. 推送代码到 GitHub

```bash
cd discord-exporter
git add .
git commit -m "feat: 添加精确时间选择功能"
git push origin main
```

### 2. 在 Zeabur 重新部署

- Zeabur 会自动检测代码更改并重新部署
- 等待部署完成（约1-2分钟）

### 3. 访问线上环境测试

- 访问 Zeabur 提供的域名
- 重复本地测试的所有步骤
- 确保功能正常

## 浏览器兼容性测试

在以下浏览器中测试时间选择器：

| 浏览器 | 版本要求 | 测试状态 |
|--------|---------|---------|
| Chrome | 90+ | ⬜ 待测试 |
| Edge | 90+ | ⬜ 待测试 |
| Firefox | 88+ | ⬜ 待测试 |
| Safari | 14.1+ | ⬜ 待测试 |

## 回归测试清单

确保原有功能不受影响：

- [ ] 论坛频道导出功能正常
- [ ] 普通文字频道导出功能正常
- [ ] 多个频道批量导出正常
- [ ] Excel 格式导出正常
- [ ] TXT 格式导出正常
- [ ] HTML 格式导出正常
- [ ] Token 设置功能正常
- [ ] 实时进度显示正常
- [ ] 下载链接正常工作
- [ ] 错误提示正常显示

## 性能测试

- [ ] 大量消息（1000+）导出正常
- [ ] 多个频道同时导出不超时
- [ ] 内存使用正常（无内存泄漏）
- [ ] 后台任务正常结束

## 已知限制

1. 时间选择器的外观在不同浏览器中可能略有差异（这是浏览器原生控件的正常行为）
2. 在某些旧版浏览器中，`datetime-local` 可能降级为普通文本输入框
3. 时间精度为分钟级，不支持秒级选择（这是 `datetime-local` 的标准行为）

## 如果测试失败

1. 检查浏览器控制台是否有 JavaScript 错误
2. 检查 Network 标签，确认请求格式正确
3. 查看服务器日志，确认后端处理正常
4. 确认 Discord Bot Token 有效且有足够权限

## 反馈问题

测试过程中发现问题，请记录：
- 操作步骤
- 预期结果
- 实际结果
- 浏览器版本
- 错误截图或日志
